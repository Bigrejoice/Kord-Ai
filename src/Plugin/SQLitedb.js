const a0_0x45b9e7=a0_0xe282;(function(_0x56ef73,_0x1a1600){const _0x5719b8=a0_0xe282,_0x30d15c=_0x56ef73();while(!![]){try{const _0x4ac519=-parseInt(_0x5719b8(0x1aa))/0x1*(-parseInt(_0x5719b8(0x1ab))/0x2)+-parseInt(_0x5719b8(0x1a6))/0x3+-parseInt(_0x5719b8(0x19c))/0x4+-parseInt(_0x5719b8(0x1ac))/0x5+-parseInt(_0x5719b8(0x198))/0x6+-parseInt(_0x5719b8(0x17a))/0x7*(-parseInt(_0x5719b8(0x192))/0x8)+parseInt(_0x5719b8(0x1a4))/0x9*(parseInt(_0x5719b8(0x18a))/0xa);if(_0x4ac519===_0x1a1600)break;else _0x30d15c['push'](_0x30d15c['shift']());}catch(_0x189ada){_0x30d15c['push'](_0x30d15c['shift']());}}}(a0_0x1824,0xb222c));function a0_0xe282(_0x51a533,_0xd3e564){const _0x1824ea=a0_0x1824();return a0_0xe282=function(_0xe28299,_0x4f2ac7){_0xe28299=_0xe28299-0x17a;let _0x522869=_0x1824ea[_0xe28299];return _0x522869;},a0_0xe282(_0x51a533,_0xd3e564);}const sqlite3=require(a0_0x45b9e7(0x180)),{open}=require('sqlite'),path=require(a0_0x45b9e7(0x186)),chalk=require(a0_0x45b9e7(0x19e));function a0_0x1824(){const _0x2f80cb=['now','writeMessage','SQLite\x20store\x20initialized\x20successfully','BEGIN\x20TRANSACTION','path','changes','length','PRAGMA\x20journal_mode\x20=\x20WAL;','10ENllcY','PRAGMA\x20synchronous\x20=\x20NORMAL;','shift','messages.upsert','parse','red','Error\x20loading\x20message:','COMMIT','31608uBFZHO','logger','queueProcessor','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20CREATE\x20INDEX\x20IF\x20NOT\x20EXISTS\x20idx_remoteJid_timestamp\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ON\x20messages\x20(remoteJid,\x20timestamp\x20DESC)\x0a\x20\x20\x20\x20\x20\x20\x20\x20','green','run','6185556GGfmtI','error','SELECT\x20message\x20FROM\x20messages\x20WHERE\x20remoteJid\x20=\x20?\x20ORDER\x20BY\x20timestamp\x20DESC\x20LIMIT\x20?','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20messages\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id\x20TEXT\x20PRIMARY\x20KEY,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20remoteJid\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20message\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20timestamp\x20INTEGER,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20pushName\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20participant\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20messageType\x20TEXT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)\x0a\x20\x20\x20\x20\x20\x20\x20\x20','2285816CRUIrq','close','chalk','Database','writeQueue','addToQueue','Cleanup\x20error','isProcessingQueue','30761685BewJna','push','3464586kIzrIG','bind','loadMessage','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20INSERT\x20OR\x20REPLACE\x20INTO\x20messages\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(id,\x20remoteJid,\x20message,\x20timestamp,\x20pushName,\x20participant)\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?)','3dwTojc','246198TiEUsD','4721945uBOkFN','createSchema','finalize','Database\x20connection\x20closed\x20successfully','DELETE\x20FROM\x20messages\x20WHERE\x20timestamp\x20<\x20?','log','prepare','join','processQueue','floor','initialize','Error\x20processing\x20write\x20queue:','1141HwkZdg','exports','\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20CREATE\x20INDEX\x20IF\x20NOT\x20EXISTS\x20idx_remoteJid\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ON\x20messages\x20(remoteJid)\x0a\x20\x20\x20\x20\x20\x20\x20\x20','all','Error\x20getting\x20chat\x20history:','messages.db','sqlite3','exec'];a0_0x1824=function(){return _0x2f80cb;};return a0_0x1824();}class DatabaseManager{static async[a0_0x45b9e7(0x1ad)](_0x2f3baa){const _0x2c9210=a0_0x45b9e7;await _0x2f3baa[_0x2c9210(0x181)](_0x2c9210(0x189)),await _0x2f3baa[_0x2c9210(0x181)](_0x2c9210(0x18b)),await _0x2f3baa[_0x2c9210(0x181)](_0x2c9210(0x19b)),await _0x2f3baa[_0x2c9210(0x181)](_0x2c9210(0x17c)),await _0x2f3baa[_0x2c9210(0x181)](_0x2c9210(0x195));}}class MessageQueueProcessor{constructor(_0x482a70){const _0x4532f8=a0_0x45b9e7;this['db']=_0x482a70,this[_0x4532f8(0x1a0)]=[],this[_0x4532f8(0x1a3)]=![];}async[a0_0x45b9e7(0x1b4)](){const _0x53442e=a0_0x45b9e7;if(this[_0x53442e(0x1a3)]||this['writeQueue']['length']===0x0)return;this[_0x53442e(0x1a3)]=!![];try{await this['db']['run'](_0x53442e(0x185));const _0x3f8e36=await this['db'][_0x53442e(0x1b2)](_0x53442e(0x1a9));while(this[_0x53442e(0x1a0)][_0x53442e(0x188)]>0x0){const _0x5e0e9d=this[_0x53442e(0x1a0)][_0x53442e(0x18c)](),{key:_0x817778,messageTimestamp:_0x3583d8,pushName:_0x42b45a,participant:_0x5979f9}=_0x5e0e9d;await _0x3f8e36['run'](_0x817778['id'],_0x817778['remoteJid'],JSON['stringify'](_0x5e0e9d),_0x3583d8,_0x42b45a,_0x5979f9);}await _0x3f8e36[_0x53442e(0x1ae)](),await this['db'][_0x53442e(0x197)](_0x53442e(0x191));}catch(_0xc726b){console[_0x53442e(0x199)](chalk[_0x53442e(0x18f)](_0x53442e(0x1b7),_0xc726b)),await this['db'][_0x53442e(0x197)]('ROLLBACK'),this['writeQueue']['unshift'](...this[_0x53442e(0x1a0)]);}finally{this[_0x53442e(0x1a3)]=![],setTimeout(()=>this[_0x53442e(0x1b4)](),0x64);}}[a0_0x45b9e7(0x1a1)](_0x3b9d8e){const _0x18b087=a0_0x45b9e7;this[_0x18b087(0x1a0)][_0x18b087(0x1a5)](_0x3b9d8e),!this[_0x18b087(0x1a3)]&&this['processQueue']();}}class SQLiteMessageStore{constructor(_0x34724c){const _0x5f4544=a0_0x45b9e7;this[_0x5f4544(0x193)]=_0x34724c,this['db']=null,this['queueProcessor']=null;}async[a0_0x45b9e7(0x1b6)](){const _0x25adfe=a0_0x45b9e7;try{this['db']=await open({'filename':path[_0x25adfe(0x1b3)](__dirname,'..',_0x25adfe(0x17f)),'driver':sqlite3[_0x25adfe(0x19f)]}),await DatabaseManager['createSchema'](this['db']),this[_0x25adfe(0x194)]=new MessageQueueProcessor(this['db']),console['log'](chalk[_0x25adfe(0x196)](_0x25adfe(0x184)));}catch(_0x144ecd){console['error'](chalk['red']('Error\x20initializing\x20SQLite\x20store:',_0x144ecd));throw _0x144ecd;}}async[a0_0x45b9e7(0x183)](_0x56b81d){const _0x553754=a0_0x45b9e7;this[_0x553754(0x194)][_0x553754(0x1a1)](_0x56b81d);}async[a0_0x45b9e7(0x1a8)](_0x51a5ee,_0x5b95ad){const _0x2d7dc6=a0_0x45b9e7;try{const _0x2c6036=await this['db']['get']('SELECT\x20message\x20FROM\x20messages\x20WHERE\x20remoteJid\x20=\x20?\x20AND\x20id\x20=\x20?',[_0x51a5ee,_0x5b95ad]);return _0x2c6036?JSON[_0x2d7dc6(0x18e)](_0x2c6036['message']):undefined;}catch(_0x3ed516){return console[_0x2d7dc6(0x199)](chalk['red'](_0x2d7dc6(0x190),_0x3ed516)),undefined;}}async['getChatHistory'](_0x41d7d4,_0x320c3c=0x32){const _0x244848=a0_0x45b9e7;try{return await this['db'][_0x244848(0x17d)](_0x244848(0x19a),[_0x41d7d4,_0x320c3c]);}catch(_0x1f750c){return console['error'](chalk[_0x244848(0x18f)](_0x244848(0x17e),_0x1f750c)),[];}}async['clearOldMessages'](_0x5ae3df=0x1){const _0x64904f=a0_0x45b9e7;try{const _0x5bac87=Math[_0x64904f(0x1b5)](Date[_0x64904f(0x182)]()/0x3e8)-_0x5ae3df*0x18*0x3c*0x3c,_0x3b3b08=await this['db'][_0x64904f(0x197)](_0x64904f(0x1b0),[_0x5bac87]);_0x3b3b08[_0x64904f(0x187)]>0x3e8&&await this['db'][_0x64904f(0x197)]('VACUUM');}catch(_0x3428f9){console['error'](_0x64904f(0x1a2));}}async[a0_0x45b9e7(0x1a7)](_0x5b4d66){const _0x53c860=a0_0x45b9e7;_0x5b4d66['on'](_0x53c860(0x18d),async({messages:_0x43afc2})=>{const _0x2a7208=_0x53c860;for(const _0x1f8217 of _0x43afc2){await this[_0x2a7208(0x183)](_0x1f8217);}});}async['close'](){const _0x3a69bd=a0_0x45b9e7;try{this['db']&&(await this['db'][_0x3a69bd(0x19d)](),console[_0x3a69bd(0x1b1)](chalk['green'](_0x3a69bd(0x1af))));}catch(_0x1abd6b){console[_0x3a69bd(0x199)](chalk[_0x3a69bd(0x18f)]('Error\x20closing\x20database\x20connection:',_0x1abd6b));}}}module[a0_0x45b9e7(0x17b)]=SQLiteMessageStore,module[a0_0x45b9e7(0x17b)]['DatabaseManager']=DatabaseManager;